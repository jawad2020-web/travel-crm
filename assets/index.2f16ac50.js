var re=Object.defineProperty;var q=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var G=(e,a,l)=>a in e?re(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,J=(e,a)=>{for(var l in a||(a={}))ie.call(a,l)&&G(e,l,a[l]);if(q)for(var l of q(a))de.call(a,l)&&G(e,l,a[l]);return e};import{X as B,r as c,d as A,D as Z,o as b,I as U,Z as O,w as n,s as t,Q as pe,y as L,A as D,B as H,C as F,T as M,_ as Y,E as me,l as ce,G as fe,i as K,N as P,J as _e,z as v,k as m,j as z,K as Q,L as W,M as ve,O as X,S as ge,U as ye,V as E,ah as he,W as be}from"./index.b77916f9.js";import{u as we,E as Ce,D as $e,P as Ve,M as Ue}from"./userPagination.8b349a3f.js";import{a as Se,g as ke,u as Re,_ as Ee}from"./role.3304a090.js";import{a as Ae}from"./company.adc6f989.js";import"./permission.cabd79a1.js";function Pe(e){return B.request({url:"/users",method:"get",params:e})}function ze(e){return B.request({url:"/users",method:"POST",params:e},{isTransformResponse:!1})}function Ne(e){return B.request({url:`/users/${e}`,method:"DELETE"})}let N=null;function Te(e=!1){const a=c(!1),l=c([]),o=(u="")=>{N&&clearTimeout(N),N=setTimeout(()=>{a.value=!0,Se({name:u,pageSize:1e3}).then(f=>{l.value=f.data,e&&u&&(l.value.some(_=>_.name===u)||l.value.unshift({id:0,name:u})),a.value=!1}).catch(()=>{a.value=!1})},500)};return o(),{filterRoles:o,filteredRoles:l,rolesLoading:a}}const Be=A({props:{modelValue:{type:[String,Array,Object,Number,Boolean]},labelField:{type:String,default:"name"},placeholder:{type:String,default:"Search Roles"},clearable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},tag:{type:Boolean,default:!1},valueField:{type:String,default:"id"}},emits:["update:modelValue"],setup(e){const{filterRoles:a,filteredRoles:l,rolesLoading:o}=Te(e.tag),u=c(null);return{filterRoles:a,filteredRoles:l,rolesLoading:o,selectValue:u}},watch:{modelValue:function(e){this.selectValue=e}},methods:{onChangeValue(e){this.$emit("update:modelValue",e)}}});function Oe(e,a,l,o,u,f){const _=O;return b(),U(_,{multiple:e.multiple,filterable:!0,tag:e.tag,placeholder:e.placeholder,"on-update:value":e.onChangeValue,value:e.selectValue,"onUpdate:value":a[0]||(a[0]=s=>e.selectValue=s),clearable:e.clearable,remote:!0,"clear-filter-after-select":!1,"label-field":e.labelField,"value-field":e.valueField,loading:e.rolesLoading,options:e.filteredRoles,onSearch:e.filterRoles},null,8,["multiple","tag","placeholder","on-update:value","value","clearable","label-field","value-field","loading","options","onSearch"])}const Le=Z(Be,[["render",Oe]]);let T=null;function De(e=!1){const a=c(!1),l=c([]),o=(u="")=>{T&&clearTimeout(T),T=setTimeout(()=>{a.value=!0,Ae({company_name:u,pageSize:1e3}).then(f=>{l.value=f.data,e&&u&&(l.value.some(_=>_.company_name===u)||l.value.unshift({id:0,company_name:u})),a.value=!1}).catch(()=>{a.value=!1})},500)};return o(),{filterCompany:o,filteredCompany:l,companyLoading:a}}const Fe=A({props:{modelValue:{type:[String,Array,Object,Number,Boolean]},labelField:{type:String,default:"name"},placeholder:{type:String,default:"Search Company"},clearable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},tag:{type:Boolean,default:!1},valueField:{type:String,default:"id"}},emits:["update:modelValue"],setup(e){const{filterCompany:a,filteredCompany:l,companyLoading:o}=De(e.tag),u=c(null);return{filterCompany:a,filteredCompany:l,companyLoading:o,selectValue:u}},watch:{modelValue:function(e){this.selectValue=e}},methods:{onChangeValue(e){this.$emit("update:modelValue",e)}}});function Me(e,a,l,o,u,f){const _=O;return b(),U(_,{multiple:e.multiple,filterable:!0,tag:e.tag,placeholder:e.placeholder,"on-update:value":e.onChangeValue,value:e.selectValue,"onUpdate:value":a[0]||(a[0]=s=>e.selectValue=s),clearable:e.clearable,remote:!0,"clear-filter-after-select":!1,"label-field":e.labelField,"value-field":e.valueField,loading:e.companyLoading,options:e.filteredCompany,onSearch:e.filterCompany},null,8,["multiple","tag","placeholder","on-update:value","value","clearable","label-field","value-field","loading","options","onSearch"])}const Ie=Z(Fe,[["render",Me]]),je=A({__name:"AddUser",emits:["created"],setup(e,{emit:a}){const l=c({}),o=c(null),u=c({email:{required:!0,message:"Please Enter Name",trigger:"blur"},user_type:{required:!0,message:"Please Select User Type",trigger:"blur"},password:{required:!0,message:"Please Enter User password",trigger:"blur"}}),f=_=>{var s;_.preventDefault(),(s=o.value)==null||s.validate(d=>{d?(console.log(d),window.$message.error("Please fill out required fields")):ze(J({},l.value)).then(p=>{window.$message.success(p.message),a("created",p.result)})})};return(_,s)=>{const d=D,p=H,w=O,$=Ie,C=Le,h=F,S=M,V=Y;return b(),U(V,{ref_key:"formRef",ref:o,"label-width":80,model:l.value,rules:u.value,size:"small"},{default:n(()=>[t(p,{style:{"padding-top":"24px"},label:"Email",path:"email"},{default:n(()=>[t(d,{value:l.value.email,"onUpdate:value":s[0]||(s[0]=g=>l.value.email=g),placeholder:"Enter email"},null,8,["value"])]),_:1}),t(p,{label:"User Type",path:"user_type"},{default:n(()=>[t(w,{value:l.value.user_type,"onUpdate:value":s[1]||(s[1]=g=>l.value.user_type=g),filterable:"",placeholder:"Select Option",options:[{label:"Company Admin",value:"company admin"},{label:"User",value:"user"}]},null,8,["value"])]),_:1}),l.value.user_type==="company admin"?(b(),U(p,{key:0,label:"Company",path:"company_id"},{default:n(()=>[t($,{value:l.value.company_id,"onUpdate:value":s[2]||(s[2]=g=>l.value.company_id=g),"label-field":"company_name","value-field":"id",tag:!1},null,8,["value"])]),_:1})):pe("",!0),t(p,{style:{"padding-top":"24px"},label:"Roles",path:"roles"},{default:n(()=>[t(C,{value:l.value.roles,"onUpdate:value":s[3]||(s[3]=g=>l.value.roles=g),"label-field":"name","value-field":"id",tag:!0},null,8,["value"])]),_:1}),t(p,{style:{"padding-top":"24px"},label:"Password",path:"password"},{default:n(()=>[t(d,{type:"password",value:l.value.password,"onUpdate:value":s[4]||(s[4]=g=>l.value.password=g),placeholder:"Enter password"},null,8,["value"])]),_:1}),t(p,{style:{"padding-top":"24px"},label:"Confirm Password",path:"confirmPassword"},{default:n(()=>[t(d,{type:"password",value:l.value.confirmPassword,"onUpdate:value":s[5]||(s[5]=g=>l.value.confirmPassword=g),placeholder:"Enter confirm password"},null,8,["value"])]),_:1}),t(S,{vertical:!0,style:{"align-items":"center"}},{default:n(()=>[t(p,null,{default:n(()=>[t(h,{style:{alignment:"center"},onClick:f},{default:n(()=>[L(" Create")]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),qe=A({__name:"EditUser",props:{id:{type:Number}},emits:["updated"],setup(e,{emit:a}){const l=e,o=c({}),u=c(null);ke(l.id).then(s=>{o.value=s,o.value.permissions=o.value.permissions.map(d=>d.id)});const f=c({name:{required:!0,message:"Please Enter Name",trigger:"blur"}}),_=s=>{var d;s.preventDefault(),(d=u.value)==null||d.validate(p=>{if(p)console.log(p),window.$message.error("Invalid");else{const{name:w,description:$,permissions:C}=o.value;Re(o.value.id,{name:w,description:$,permissions:C}).then(h=>{window.$message.success(h.message),a("updated",h)})}})};return(s,d)=>{const p=D,w=H,$=Ee,C=F,h=M,S=Y;return b(),U(S,{ref_key:"formRef",ref:u,"label-width":80,model:o.value,rules:f.value,size:"small"},{default:n(()=>[t(w,{style:{"padding-top":"24px"},label:"Name",path:"name"},{default:n(()=>[t(p,{value:o.value.name,"onUpdate:value":d[0]||(d[0]=V=>o.value.name=V),placeholder:"Edit Name"},null,8,["value"])]),_:1}),t(w,{style:{"padding-top":"24px"},label:"Permissions",path:"permissions"},{default:n(()=>[t($,{value:o.value.permissions,"onUpdate:value":d[1]||(d[1]=V=>o.value.permissions=V),"label-field":"name","value-field":"id",tag:!0},null,8,["value"])]),_:1}),t(h,{vertical:!0,style:{"align-items":"center"}},{default:n(()=>[t(w,null,{default:n(()=>[t(C,{style:{alignment:"center"},onClick:_},{default:n(()=>[L(" Save")]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}}),Ge=m("thead",null,[m("tr",null,[m("th",null,"Name"),m("th",null,"Email"),m("th",null,"Permissions"),m("th",null,"Created At"),m("th",null,"Type"),m("th",null,"Actions")])],-1),Je=m("div",null,"Create New Role",-1),Ke=m("div",null,"Update Role",-1),xe=A({__name:"index",setup(e){const a=me(),l=c(null),o=c(!1),u=c(!1),f=c(),_=ce(),{getList:s,list:d,page:p,pageSizes:w,itemCount:$,pageSize:C,params:h}=we(Pe);console.log("fetch users list ==>",d);const S=y=>()=>K(P,null,{default:()=>K(y)}),V=c([{label:"Edit",key:"edit",icon:S(Ce)},{label:"Delete",key:"delete",icon:S($e)}]);function g(){a.error({title:"Confirmation",content:()=>"Are you sure you want to delete?",positiveText:"Delete",negativeText:"Cancel",onPositiveClick:x})}function x(){const y=window.$loading||null;y.start(),Ne(f.value).then(r=>{_.success(r.message),s(),y.finish(),a.destroyAll}).catch(r=>{_.error(r.message),y.finish(),a.destroyAll}),f.value=null,l.value=null}const ee=y=>{l.value==="edit"?(u.value=!0,f.value=y.id):l.value==="delete"&&(f.value=y.id,g())},le=y=>{l.value=y},te=()=>{s(h.value)};return fe(()=>{s()}),(y,r)=>{const ae=D,ne=he,k=M,I=F,oe=be,se=ge,j=ye,ue=_e;return b(),U(ue,null,{default:n(()=>[t(k,{vertical:!0},{default:n(()=>[t(ae,{type:"text",size:"small",value:v(h).name,"onUpdate:value":r[0]||(r[0]=i=>v(h).name=i),onChange:te,placeholder:"Search by Name"},null,8,["value"]),t(se,{striped:!0},{default:n(()=>[Ge,m("tbody",null,[(b(!0),z(W,null,Q(v(d),i=>(b(),z("tr",{key:i.id},[m("td",null,E(i.name),1),m("td",null,E(i.email),1),m("td",null,[t(k,null,{default:n(()=>[(b(!0),z(W,null,Q(i.permissions,R=>(b(),U(ne,{key:R.id,type:"success"},{default:n(()=>[L(E(R==null?void 0:R.name),1)]),_:2},1024))),128))]),_:2},1024)]),m("td",null,E(i.created_at),1),m("td",null,E(i.user_type),1),m("td",null,[t(oe,{onClick:R=>ee(i),onSelect:le,trigger:"click",options:V.value},{default:n(()=>[t(I,{size:"small",circle:!0},{default:n(()=>[t(v(P),null,{default:n(()=>[t(v(Ue))]),_:1})]),_:1})]),_:2},1032,["onClick","options"])])]))),128))])]),_:1}),t(k,{style:{"align-items":"center","padding-top":"15px"}},{default:n(()=>[t(v(ve),{page:v(p),"onUpdate:page":r[1]||(r[1]=i=>X(p)?p.value=i:null),"page-size":v(C),"onUpdate:page-size":r[2]||(r[2]=i=>X(C)?C.value=i:null),"item-count":v($),"page-sizes":v(w),size:"small","show-quick-jumper":!0,"show-size-picker":!0},null,8,["page","page-size","item-count","page-sizes"])]),_:1}),t(I,{type:"primary",size:"large",circle:!0,style:{position:"fixed",bottom:"30px",right:"40px"},onClick:r[3]||(r[3]=i=>o.value=!0)},{icon:n(()=>[t(v(P),null,{default:n(()=>[t(v(Ve))]),_:1})]),_:1}),t(j,{show:o.value,"onUpdate:show":r[5]||(r[5]=i=>o.value=i),preset:"dialog"},{header:n(()=>[Je]),default:n(()=>[t(k,{vertical:!0},{default:n(()=>[t(je,{onCreated:r[4]||(r[4]=i=>{v(s)(),o.value=!1})})]),_:1})]),_:1},8,["show"]),t(j,{style:{width:"70%"},show:u.value,"onUpdate:show":r[7]||(r[7]=i=>u.value=i),preset:"dialog"},{header:n(()=>[Ke]),default:n(()=>[t(k,{vertical:!0},{default:n(()=>[t(qe,{id:f.value,onUpdated:r[6]||(r[6]=i=>{v(s)(),u.value=!1})},null,8,["id"])]),_:1})]),_:1},8,["show"])]),_:1})]),_:1})}}});export{xe as default};
